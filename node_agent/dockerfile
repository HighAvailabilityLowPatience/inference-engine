# ==========================================
# Node Agent Dockerfile (Mode Aware + Module Safe)
# ==========================================
FROM python:3.12-slim

WORKDIR /app

# Copy requirements first for caching
COPY corerequirements.txt extendedrequirements.txt ./

# Install base (core) requirements
RUN pip install --no-cache-dir -r corerequirements.txt

# Copy source code into container
COPY . .

# Explicitly set Python path so /app is recognized as the package root
ENV PYTHONPATH=/app

# Set mode (core or extended)
ENV MODE=core

# Conditional install and module-based run
CMD if [ "$MODE" = "extended" ]; then \
        pip install --no-cache-dir -r extendedrequirements.txt && \
        python -m node_agent.agent; \
    else \
        python -m node_agent.agent; \
    fi
